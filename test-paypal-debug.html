<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test PayPal - La Tierrita</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-6 text-center">Test PayPal Configuration</h1>
        
        <div id="debug-info" class="mb-6 p-4 bg-gray-50 rounded-lg">
            <h3 class="font-bold mb-2">Información de Depuración:</h3>
            <div id="debug-output"></div>
        </div>
        
        <div class="mb-6">
            <h3 class="font-bold mb-2">PayPal Button:</h3>
            <div id="paypal-button-container" class="min-h-[100px] border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center">
                <span class="text-gray-500">Cargando PayPal...</span>
            </div>
        </div>
        
        <div class="text-center">
            <button onclick="runDebug()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Ejecutar Diagnóstico
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="paypal-config.js"></script>
    <script>
        function runDebug() {
            const output = document.getElementById('debug-output');
            let html = '<div class="space-y-2 text-sm">';
            
            // Verificar PAYPAL_CONFIG
            html += `<div><strong>PAYPAL_CONFIG:</strong> ${typeof PAYPAL_CONFIG !== 'undefined' ? '✅ Disponible' : '❌ No disponible'}</div>`;
            
            if (typeof PAYPAL_CONFIG !== 'undefined') {
                html += `<div><strong>Client ID:</strong> ${PAYPAL_CONFIG.clientId ? '✅ Configurado' : '❌ No configurado'}</div>`;
                html += `<div><strong>Moneda:</strong> ${PAYPAL_CONFIG.currency}</div>`;
                html += `<div><strong>Entorno:</strong> ${PAYPAL_CONFIG.environment}</div>`;
            }
            
            // Verificar funciones
            html += `<div><strong>validatePayPalConfig:</strong> ${typeof validatePayPalConfig === 'function' ? '✅ Disponible' : '❌ No disponible'}</div>`;
            html += `<div><strong>getPayPalSDKUrl:</strong> ${typeof getPayPalSDKUrl === 'function' ? '✅ Disponible' : '❌ No disponible'}</div>`;
            
            // Verificar SDK
            html += `<div><strong>PayPal SDK:</strong> ${typeof paypal !== 'undefined' ? '✅ Cargado' : '❌ No cargado'}</div>`;
            
            // Validar configuración
            if (typeof validatePayPalConfig === 'function') {
                html += `<div><strong>Validación:</strong> ${validatePayPalConfig() ? '✅ Válida' : '❌ Inválida'}</div>`;
            }
            
            // URL del SDK
            if (typeof getPayPalSDKUrl === 'function') {
                html += `<div><strong>SDK URL:</strong> <a href="${getPayPalSDKUrl()}" target="_blank" class="text-blue-600 hover:underline">Ver URL</a></div>`;
            }
            
            html += '</div>';
            output.innerHTML = html;
        }
        
        function loadPayPalSDK() {
            return new Promise((resolve, reject) => {
                if (typeof paypal !== 'undefined') {
                    console.log('PayPal SDK ya está cargado');
                    resolve();
                    return;
                }

                if (typeof PAYPAL_CONFIG === 'undefined' || !PAYPAL_CONFIG.clientId) {
                    reject(new Error('PayPal no configurado'));
                    return;
                }

                const script = document.createElement('script');
                script.src = getPayPalSDKUrl();
                script.async = true;
                
                script.onload = function() {
                    console.log('PayPal SDK cargado correctamente');
                    resolve();
                };
                
                script.onerror = function() {
                    console.error('Error cargando PayPal SDK');
                    reject(new Error('Error cargando PayPal SDK'));
                };
                
                document.head.appendChild(script);
            });
        }
        
        function initializePayPal() {
            if (typeof paypal === 'undefined') {
                console.error('PayPal SDK no está cargado');
                return;
            }

            paypal.Buttons({
                style: {
                    layout: 'vertical',
                    color: 'gold',
                    shape: 'rect',
                    label: 'paypal',
                    height: 45
                },
                
                createOrder: function(data, actions) {
                    return actions.order.create({
                        intent: 'CAPTURE',
                        purchase_units: [{
                            amount: {
                                currency_code: 'USD',
                                value: '10.00'
                            },
                            description: 'Test de PayPal - La Tierrita'
                        }]
                    });
                },
                
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {
                        alert('Pago de prueba completado! ID: ' + details.id);
                        console.log('PayPal test payment:', details);
                    });
                },
                
                onError: function(err) {
                    console.error('PayPal error:', err);
                    alert('Error en PayPal: ' + (err.message || 'Error desconocido'));
                }
            }).render('#paypal-button-container');
        }
        
        // Inicializar cuando la página esté lista
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                runDebug();
                
                if (typeof validatePayPalConfig === 'function' && validatePayPalConfig()) {
                    loadPayPalSDK().then(() => {
                        initializePayPal();
                    }).catch(error => {
                        console.error('Error:', error);
                        document.getElementById('paypal-button-container').innerHTML = 
                            '<div class="text-red-600 p-4">Error cargando PayPal: ' + error.message + '</div>';
                    });
                } else {
                    document.getElementById('paypal-button-container').innerHTML = 
                        '<div class="text-red-600 p-4">Configuración de PayPal inválida</div>';
                }
            }, 100);
        });
    </script>
</body>
</html>
